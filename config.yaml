# Image Generator Configuration
# Мультимодельный генератор изображений с поддержкой LoRA и без цензуры

# Модель по умолчанию
default_model: "z-image-turbo"

# Конфигурация моделей
models:
  # ============================================
  # Z-Image-Turbo - быстрая генерация
  # ============================================
  z-image-turbo:
    name: "Tongyi-MAI/Z-Image-Turbo"
    torch_dtype: "bfloat16"
    low_cpu_mem_usage: false
    description: "Быстрая генерация (5-10 сек)"
    features: ["generation", "fast"]
    
  # ============================================
  # SDXL Turbo - универсальная с LoRA
  # ============================================
  sdxl-turbo:
    name: "stabilityai/sdxl-turbo"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    description: "Универсальная, поддержка LoRA, без цензуры"
    features: ["generation", "lora", "uncensored", "fast"]
    lora_support: true
    safety_checker: false  # Отключаем цензуру
    generation:
      default_num_inference_steps: 4
      default_guidance_scale: 0.0
  
  # ============================================
  # Pony Diffusion V6 - аниме/NSFW
  # ============================================
  pony-diffusion:
    name: "AstraliteHeart/pony-diffusion-v6"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    description: "Аниме стиль, NSFW из коробки"
    features: ["generation", "lora", "uncensored", "anime"]
    lora_support: true
    safety_checker: false
    generation:
      default_num_inference_steps: 25
      default_guidance_scale: 7.0
  
  # ============================================
  # RealVisXL - фотореализм
  # ============================================
  realvis-xl:
    name: "SG161222/RealVisXL_V4.0"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    description: "Фотореалистичные изображения"
    features: ["generation", "lora", "realistic"]
    lora_support: true
    safety_checker: false
    generation:
      default_num_inference_steps: 25
      default_guidance_scale: 5.0
  
  # ============================================
  # InstructPix2Pix - редактирование по тексту
  # ============================================
  instruct-pix2pix:
    name: "timbrooks/instruct-pix2pix"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    description: "Редактирование по инструкции (напр. 'сделай волосы синими')"
    features: ["edit", "fast", "instruction"]
    lora_support: false
    safety_checker: false
    generation:
      default_num_inference_steps: 20
      default_guidance_scale: 7.5
      default_image_guidance_scale: 1.5
  
  # ============================================
  # SDXL Inpainting - закрашивание/замена
  # ============================================
  sdxl-inpainting:
    name: "diffusers/stable-diffusion-xl-1.0-inpainting-0.1"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    description: "Замена/закрашивание части изображения (выделите область)"
    features: ["inpaint", "lora", "uncensored"]
    lora_support: true
    safety_checker: false
    generation:
      default_num_inference_steps: 25
      default_guidance_scale: 7.5
  
  # ============================================
  # Qwen-Image-Edit - редактирование (тяжёлая)
  # ============================================
  qwen-image-edit:
    name: "Qwen/Qwen-Image-Edit-2511"
    torch_dtype: "float16"
    low_cpu_mem_usage: true
    use_gguf: false
    description: "Мощное редактирование (1-3 мин, требует 32GB RAM)"
    features: ["edit", "slow", "powerful"]
    edit:
      default_num_inference_steps: 40
      default_guidance_scale: 1.0
      default_true_cfg_scale: 4.0
      default_num_images_per_prompt: 1
  
device:
  type: "cuda"  # cuda - использовать GPU (RTX 4060), auto - автоматически, cpu - только CPU
  enable_cpu_offload: true  # ВКЛЮЧЕНО - необходимо для 8GB VRAM, переносит часть модели в RAM
  sequential_offload: true  # true = sequential (медленнее, но экономит память) - рекомендуется для 8GB VRAM

optimization:
  attention_backend: "sdpa"  # sdpa для стабильности, flash/_flash_3 могут занимать больше памяти
  compile_model: false  # Отключено для экономии памяти (компиляция требует дополнительной памяти)
  enable_flash_attention: false  # Отключено для экономии памяти

generation:
  default_height: 384  # Уменьшено для 8GB VRAM (можно увеличить до 512/768 если работает)
  default_width: 384   # Уменьшено для 8GB VRAM
  default_num_inference_steps: 9  # Results in 8 DiT forwards for Turbo models
  default_guidance_scale: 0.0  # Should be 0 for Turbo models
  default_seed: null  # null for random seed

output:
  directory: "outputs"
  format: "png"  # png, jpg
  quality: 95  # For JPEG format

web_interface:
  port: 7860
  share: false
  title: "Image Generator"
  description: "Локальный генератор и редактор изображений с использованием Z-Image-Turbo и Qwen-Image-Edit-2511"

