# Устранение проблем

## Проблема: Загрузка модели Qwen-Image-Edit застряла

### Симптомы:
- Загрузка модели останавливается на определенном проценте
- В диспетчере задач нет активности сети
- Приложение зависает при загрузке

### Причины:
1. **Большой размер модели** (~50GB) - загрузка может занять 10-30 минут
2. **Проблемы с сетью** - нестабильное соединение или таймауты
3. **Проблемы с Hugging Face серверами** - временные сбои
4. **Недостаточно места на диске** - требуется ~50GB свободного места

### Решения:

#### Решение 1: Скачать модель заранее (РЕКОМЕНДУЕТСЯ)

Используйте отдельный скрипт для скачивания модели:

```bash
python download_models.py --model qwen-image-edit
```

Это скачает модель в фоновом режиме и позволит продолжить загрузку при прерывании.

#### Решение 2: Проверить место на диске

```bash
# Windows PowerShell
Get-PSDrive C | Select-Object Used,Free

# Или через Проводник
# Убедитесь, что есть минимум 50GB свободного места
```

#### Решение 3: Проверить интернет-соединение

```bash
# Проверка скорости
# Используйте браузер для проверки скорости на speedtest.net
# Для модели 50GB при скорости 10 Мбит/с потребуется ~11 часов
# При скорости 100 Мбит/с - ~1 час
```

#### Решение 4: Использовать локальную модель

Если модель уже скачана (даже частично), укажите путь в `config.yaml`:

```yaml
qwen-image-edit:
  name: "Qwen/Qwen-Image-Edit-2511"
  local_path: "./models/qwen-image-edit"  # Раскомментируйте
```

#### Решение 5: Пропустить загрузку Qwen при старте

Модель Qwen не загружается автоматически при старте приложения. Она загружается только при:
- Выборе модели в интерфейсе
- Попытке редактирования изображения

### Альтернатива: Использовать только Z-Image-Turbo

Если модель Qwen не нужна, можно использовать только Z-Image-Turbo для генерации изображений.

### Проверка статуса загрузки

1. Проверьте кэш Hugging Face:
   ```
   # Windows
   %USERPROFILE%\.cache\huggingface\hub\
   
   # Или через Python
   python -c "from huggingface_hub import scan_cache_dir; print(scan_cache_dir())"
   ```

2. Проверьте использование диска:
   - Модель скачивается в кэш Hugging Face
   - После загрузки модель будет кэширована локально

### Если загрузка все еще не работает

1. **Перезапустите приложение** - иногда помогает
2. **Очистите кэш Hugging Face** (если он поврежден):
   ```bash
   python -c "from huggingface_hub import scan_cache_dir; scan_cache_dir().delete_revisions('*')"
   ```
3. **Используйте VPN** - если есть проблемы с доступом к Hugging Face
4. **Скачайте модель вручную** через браузер с Hugging Face

## Проблема: CUDA out of memory

### Решение:
1. Убедитесь, что `enable_cpu_offload: true` в `config.yaml`
2. Убедитесь, что `sequential_offload: true` в `config.yaml`
3. Закройте другие приложения, использующие GPU
4. Используйте переменную окружения: `PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True`

## Проблема: Медленная генерация

### Это нормально!
С CPU offload генерация медленнее, но модель помещается в 8GB VRAM.

Для ускорения:
- Отключите `sequential_offload` (но потребуется больше VRAM)
- Используйте меньший размер изображений

