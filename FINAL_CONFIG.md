# Финальная конфигурация для RTX 4060 (8GB VRAM)

## ✅ Оптимальные настройки

После тестирования, для **RTX 4060 с 8GB VRAM** оптимальна следующая конфигурация:

### config.yaml (текущая)

```yaml
device:
  type: "cuda"
  enable_cpu_offload: true  # ОБЯЗАТЕЛЬНО для 8GB VRAM

models:
  z-image-turbo:
    torch_dtype: "float16"  # Экономит память
    low_cpu_mem_usage: true

generation:
  default_height: 512  # Начните с 512, можно увеличить до 768
  default_width: 512
```

## Почему CPU Offload необходим?

Без CPU offload модель требует ~10-12GB VRAM, что больше чем 8GB у RTX 4060.

С CPU offload:
- ✅ Модель помещается в 8GB VRAM
- ✅ GPU используется во время вычислений (80-100%)
- ✅ Стабильная работа без ошибок памяти

## Как работает CPU Offload

1. **Загрузка**: Компоненты модели хранятся в RAM
2. **Вычисления**: Нужные компоненты загружаются на GPU по очереди
3. **Результат**: GPU используется эффективно, но не постоянно

**Это нормально!** GPU работает, просто диспетчер задач показывает среднее использование, а не пиковое.

## Проверка работы GPU

Во время генерации откройте `nvidia-smi -l 1` и вы увидите:
- **GPU-Util**: 80-100% во время шагов генерации
- **Memory-Usage**: 6-7GB / 8GB
- **Power**: увеличится

## Увеличение размера изображений

После успешной генерации 512x512, попробуйте увеличить:

1. **768x768** - должно работать с CPU offload
2. **1024x1024** - может не поместиться, попробуйте

## Текущий статус

✅ CPU offload включен  
✅ Размеры уменьшены до 512x512  
✅ Float16 для экономии памяти  
✅ Все исправления применены  

**Перезапустите приложение и попробуйте снова!**

